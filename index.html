<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HuntingStats378 - Compare</title>
    <link href="https://huntingstats378.github.io/HuntingStats378/main/assets/ess/odometer.css" rel="stylesheet">
    <link rel="icon" href="https://huntingstats378.github.io/HuntingStats378/main/images/logo.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        body {
            font-family: Roboto, Arial, sans-serif;
            color: #fff;
            background-color: #E7541E;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-width: 800px;
            width: 100%;
            padding: 20px;
        }
        .channel {
            padding: 20px;
            text-align: center;
            background-color: #333;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .channel img {
            width: 125px;
            height: 125px;
            border-radius: 50%;
            margin-top: -5em;
            object-fit: cover;
            position: relative;
        }
        .channel h2 {
            margin-top: 10px;
            font-size: 4.5vh;
            cursor: pointer;
        }
        .channel h5 {
            margin-top: -15px;
        }
        .gap-container {
            width: 100%;
            max-width: 400px;
            text-align: center;
            margin-top: 20px;
            background-color: #333;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .gap-container h1 {
            font-size: 3rem;
            margin-top: 10px;
        }
        #chart-container {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="channel" id="channel1">
            <img id="image1" src="https://huntingstats378.github.io/HuntingStats378/main/images/default.png" alt="Channel Avatar">
            <h2 id="name1" onclick="search1()">Loading</h2>
            <h2 id="subs1" class="odometer">0</h2>
            <h5 id="footer1">Subscribers</h5>
        </div>
        <div class="channel" id="channel2">
            <img id="image2" src="https://huntingstats378.github.io/HuntingStats378/main/images/default.png" alt="Channel Avatar">
            <h2 id="name2" onclick="search2()">Loading</h2>
            <h2 id="subs2" class="odometer">0</h2>
            <h5 id="footer2">Subscribers</h5>
        </div>
    </div>
    <div class="gap-container">
        <h1>Gap:</h1>
        <h1 id="gap" class="odometer">0</h1>
    </div>
    <div id="chart-container"></div>
    <script src="https://huntingstats378.github.io/HuntingStats378/main/assets/ess/odometer.js"></script>
    <script>
        const searchParams1 = new URLSearchParams(window.location.search);
        const id1 = searchParams1.get("id1") || "UCq-Fj5jknLsUf-MWSy4_brA";
        const searchParams2 = new URLSearchParams(window.location.search);
        const id2 = searchParams2.get("id2") || "UCX6OQ3DkcsbYNE6H8uQQuVA";

        // Initialize Highcharts chart
        const chart = Highcharts.chart('chart-container', {
            chart: {
                type: 'line',
                backgroundColor: 'transparent',
                plotBorderColor: 'transparent',
                height: 300,
                style: {
                    fontFamily: 'Roboto, Arial, sans-serif',
                    color: '#fff'
                }
            },
            title: {
                text: 'Subscriber Difference Over Time'
            },
            xAxis: {
                type: 'datetime',
                labels: {
                    style: {
                        color: '#bdbdbd'
                    }
                }
            },
            yAxis: {
                title: {
                    text: 'Subscriber Difference'
                },
                labels: {
                    style: {
                        color: '#bdbdbd'
                    }
                }
            },
            series: [{
                name: 'Subscriber Difference',
                color: '#ffffff',
                lineColor: '#ffffff',
                data: []
            }]
        });

        // Function to fetch data and update UI
        function fetchData() {
            fetch(`https://nia-statistics.com/api/get?platform=youtube&type=channel&id=${id1}`)
                .then(res => res.json())
                .then(data1 => {
                    fetch(`https://nia-statistics.com/api/get?platform=youtube&type=channel&id=${id2}`)
                        .then(res => res.json())
                        .then(data2 => {
                            document.getElementById("image1").src = data1.snippet.thumbnails.high.url;
                            document.getElementById("name1").textContent = data1.snippet.title;
                            document.getElementById("subs1").innerHTML = data1.estSubCount;
                            document.getElementById("image2").src = data2.snippet.thumbnails.high.url;
                            document.getElementById("name2").textContent = data2.snippet.title;
                            document.getElementById("subs2").innerHTML = data2.estSubCount;
                            
                            const difference = data1.estSubCount - data2.estSubCount;
                            document.getElementById("gap").innerHTML = difference;

                            // Add point to the chart series
                            const currentTime = Date.now();
                            chart.series[0].addPoint([currentTime, difference]);

                            // Remove points beyond 50 data points
                            if (chart.series[0].points.length > 50) {
                                chart.series[0].points[0].remove();
                            }
                        });
                });
        }

        // Fetch data every 2 seconds
        setInterval(fetchData, 2000);

        // Function to handle channel search for first channel
        function search1() {
            const prompt = window.prompt("Enter channel name, ID, or URL.");
            if (prompt) {
                fetch(`https://axern.space/api/search?platform=youtube&type=channel&query=${prompt}`)
                    .then(res => res.json())
                    .then(data1 => {
                        searchParams1.set("id1", data1[0].id);
                        window.location.href = "?" + searchParams1.toString();
                    });
            }
        }

        // Function to handle channel search for second channel
        function search2() {
            const prompt = window.prompt("Enter channel name, ID, or URL.");
            if (prompt) {
                fetch(`https://axern.space/api/search?platform=youtube&type=channel&query=${prompt}`)
                    .then(res => res.json())
                    .then(data2 => {
                        searchParams2.set("id2", data2[0].id);
                        window.location.href = "?" + searchParams2.toString();
                    });
            }
        }
    </script>
</body>
</html>
